<% include layout/header %>

<div class="main">
  <% include layout/nav %>
  <div class="container-fluid">
    <div class="page-title">
      <h1>所有文章</h1>
      <a href="postAdd" class="btn btn-primary btn-xs">写文章</a>
    </div>
    <!-- 有错误信息时展示 -->
    <!-- <div class="alert alert-danger">
        <strong>错误！</strong>发生XXX错误
      </div> -->
    <div class="page-action">
      <!-- show when multiple checked -->
      <a class="btn btn-danger btn-sm" href="javascript:;" style="display: none">批量删除</a>
      <form class="form-inline">
        <select id="category" name="category" class="form-control input-sm">
          <option value="">所有分类</option>

        </select>
        <select name="" class="form-control input-sm">
          <option value="">所有状态</option>
          <option value="">草稿</option>
          <option value="">已发布</option>
        </select>
        <button class="btn btn-default btn-sm">筛选</button>
      </form>
      <ul id="pagination" class="pagination pagination-sm pull-right">
  
      </ul>
    </div>
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th class="text-center" width="40"><input type="checkbox"></th>
          <th>标题</th>
          <th>作者</th>
          <th>分类</th>
          <th class="text-center">发表时间</th>
          <th class="text-center">状态</th>
          <th class="text-center" width="100">操作</th>
        </tr>
      </thead>
      <tbody id="posts_tbody">

      </tbody>
    </table>
  </div>
</div>

<% include layout/aside %>
<% include layout/footer %>
<script src="/assets/vendors/twbs-pagination/jquery.twbsPagination.js"></script>
<script id="tmp" type="text/html">
  {{each data}}
  <option value="{{ $value.id }}">{{ $value.name }}</option>
  {{/each}}
</script>
<script id="tmpTwo" type="text/html">
  {{ each params }}
  <tr>
    <td class="text-center"><input type="checkbox"></td>
    <td>{{ $value.title }}</td>
    <td>{{ $value.user_id}}</td>
    <td>{{ $value.category_id }}</td>
    <td class="text-center">{{ $value.created }}</td>
    <td class="text-center">{{ $value.status === 'published' ? '已发布' : '草稿' }}</td>
    <td class="text-center">
      <a href="javascript:;" class="btn btn-default btn-xs">编辑</a>
      <a href="javascript:;" class="btn btn-danger btn-xs">删除</a>
    </td>
  </tr>
  {{ /each }}
</script>
<script>
  //页面打开动态渲染分类信息
  function getSelect() {
    //发送异步请求
    $.ajax({
      url: '/getAllData',
      type: 'GET',
      success: function (res) {
        let html = template('tmp', res)
        //添加到所属分类
        $('#category').append(html);
      }
    });
  };
  //调用方法
  getSelect();

  //页面打开动态获取所有文章信息
  function getPostsData() {
    //发送异步请求
    $.ajax({
      url: '/getPostsData',
      type: 'GET',
      success: function (res) {
        let { status, msg } = res;
        if (status === 200) {
          let html = template('tmpTwo', res);
          $('#posts_tbody').html(html);
        } else {
          alert(msg);
        };
      }
    });
  };
  //调用方法
  getPostsData();

  //初始化分页插件
  function initPage() {
    $('#pagination').twbsPagination({
      totalPages: 10, // 总页数
      visiblePages: 5, // 可见页数
      // startPage: 1, // 初始化页数
      hideOnlyOnePage: true, // 只有一页时隐藏
      first: '首页', // 第一页显示的文本
      last: '尾页', // 最后页显示的文本
      prev: '上一页', // 上一页
      next: '下一页', // 下一页
      onPageClick: function (event, page) { // 点击分页元素时触发事件
        // page 就是当前页数
      }
    });
  }
  initPage()
</script>